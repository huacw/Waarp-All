<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FtpPrivateMib.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Waarp Gateway Ftp</a> &gt; <a href="index.source.html" class="el_package">org.waarp.gateway.ftp.snmp</a> &gt; <span class="el_source">FtpPrivateMib.java</span></div><h1>FtpPrivateMib.java</h1><pre class="source lang-java linenums">/*
 * This file is part of Waarp Project (named also Waarp or GG).
 *
 *  Copyright (c) 2019, Waarp SAS, and individual contributors by the @author
 *  tags. See the COPYRIGHT.txt in the distribution for a full listing of
 * individual contributors.
 *
 *  All Waarp Project is free software: you can redistribute it and/or
 * modify it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or (at your
 * option) any later version.
 *
 * Waarp is distributed in the hope that it will be useful, but WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
 * A PARTICULAR PURPOSE. See the GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License along with
 * Waarp . If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */
package org.waarp.gateway.ftp.snmp;

import org.snmp4j.agent.DuplicateRegistrationException;
import org.snmp4j.agent.MOScope;
import org.snmp4j.agent.MOServer;
import org.snmp4j.agent.mo.MOAccessImpl;
import org.snmp4j.agent.mo.snmp.SNMPv2MIB;
import org.snmp4j.agent.mo.snmp.SysUpTime;
import org.snmp4j.mp.SnmpConstants;
import org.snmp4j.smi.Integer32;
import org.snmp4j.smi.OID;
import org.snmp4j.smi.OctetString;
import org.snmp4j.smi.SMIConstants;
import org.snmp4j.smi.TimeTicks;
import org.snmp4j.smi.VariableBinding;
import org.waarp.common.command.ReplyCode;
import org.waarp.common.logging.WaarpLogger;
import org.waarp.common.logging.WaarpLoggerFactory;
import org.waarp.common.utility.Version;
import org.waarp.gateway.ftp.config.FileBasedConfiguration;
import org.waarp.gateway.ftp.database.data.DbTransferLog;
import org.waarp.snmp.WaarpSnmpAgent;
import org.waarp.snmp.interf.WaarpInterfaceMib;
import org.waarp.snmp.r66.WaarpPrivateMib;
import org.waarp.snmp.utils.MemoryGauge32;
import org.waarp.snmp.utils.MemoryGauge32.MemoryType;
import org.waarp.snmp.utils.WaarpEntry;
import org.waarp.snmp.utils.WaarpMORow;
import org.waarp.snmp.utils.WaarpMOScalar;
import org.waarp.snmp.utils.WaarpUptime;

/**
 * FTP Private MIB implementation
 */
public class FtpPrivateMib implements WaarpInterfaceMib {
  /**
   * Internal Logger
   */
<span class="fc" id="L58">  private static final WaarpLogger logger =</span>
<span class="fc" id="L59">      WaarpLoggerFactory.getLogger(FtpPrivateMib.class);</span>

  public static final String SnmpName = &quot;Waarp GW FTP SNMP&quot;;

  public static final int SnmpPrivateId = 66666;

  public static final int SnmpFtpId = 21;

  public static final String SnmpDefaultAuthor = &quot;Frederic Bregier&quot;;

<span class="fc" id="L69">  public static final String SnmpVersion =</span>
<span class="fc" id="L70">      &quot;Waarp GW FTP &quot; + Version.fullIdentifier();</span>

  public static final String SnmpDefaultLocalization = &quot;Paris, France&quot;;

  public static final int SnmpService = 72;

  /**
   * SnmpConstants.sysObjectID
   */
  public final OID ggObjectId; // will be smiPrivateCode.typeWaarp

  /**
   * SnmpConstants.sysUpTime
   */
  public SysUpTime upTime;

  /**
   * need to add &quot;.port&quot; like &quot;6666&quot; Only in TCP (no UDP supported for Waarp)
   * &lt;p&gt;
   * example: rootEnterpriseMib+&quot;66666&quot;+&quot;.1.1.4.&quot;;
   */
  public final String applicationProtocolBase;

  /**
   * will be = new OID(applicationProtocolBase+port);
   */
  public final OID applicationProtocol;

  /**
   * root OID in String
   */
  public final String srootOIDWaarp;

  /**
   * root OID
   */
  public final OID rootOIDWaarp;

  /**
   * Used in Notify
   */
  public final OID rootOIDWaarpNotif;

  /**
   * Used in Notify Start or Shutdown
   */
  public final OID rootOIDWaarpNotifStartOrShutdown;

  /**
   * Info static part
   */
  public final OID rootOIDWaarpInfo;

  /**
   * Info Row access
   */
  public WaarpMORow rowInfo;

  /**
   * Global dynamic part
   */
  public final OID rootOIDWaarpGlobal;

  /**
   * Global Row access
   */
  public WaarpMORow rowGlobal;

  /**
   * Uptime OID
   */
  public final OID rootOIDWaarpGlobalUptime;

  /**
   * Corresponding UpTime in Mib
   */
  public WaarpMOScalar scalarUptime;

  /**
   * Detailed dynamic part
   */
  public final OID rootOIDWaarpDetailed;

  /**
   * Detailed Row access
   */
  public WaarpMORow rowDetailed;

  /**
   * Error dynamic part
   */
  public final OID rootOIDWaarpError;

  /**
   * Error Row access
   */
  public WaarpMORow rowError;

  /**
   * New SNMPV2 MIB
   */
  public SNMPv2MIB snmpv2;

  /**
   * Corresponding agent
   */
  public WaarpSnmpAgent agent;

  /**
   * @param port port used by FTP server
   */
<span class="fc" id="L181">  public FtpPrivateMib(int port) {</span>
<span class="fc" id="L182">    srootOIDWaarp = rootEnterpriseMib + &quot;.&quot; + SnmpPrivateId + '.' + SnmpFtpId;</span>
<span class="fc" id="L183">    applicationProtocolBase = srootOIDWaarp + &quot;.1.1.4.&quot;;</span>
<span class="fc" id="L184">    ggObjectId = new OID(srootOIDWaarp);</span>
<span class="fc" id="L185">    applicationProtocol = new OID(applicationProtocolBase + port);</span>
<span class="fc" id="L186">    rootOIDWaarp = new OID(srootOIDWaarp);</span>
<span class="fc" id="L187">    rootOIDWaarpInfo = new OID(srootOIDWaarp + &quot;.1&quot;);</span>
<span class="fc" id="L188">    rootOIDWaarpGlobal = new OID(srootOIDWaarp + &quot;.2&quot;);</span>
<span class="fc" id="L189">    rootOIDWaarpGlobalUptime = new OID(</span>
<span class="fc" id="L190">        rootOIDWaarpGlobal + &quot;.&quot; + WaarpGlobalValuesIndex.applUptime.getOID() +</span>
        &quot;.0&quot;);
<span class="fc" id="L192">    rootOIDWaarpDetailed = new OID(srootOIDWaarp + &quot;.3&quot;);</span>
<span class="fc" id="L193">    rootOIDWaarpError = new OID(srootOIDWaarp + &quot;.4&quot;);</span>
<span class="fc" id="L194">    rootOIDWaarpNotif = new OID(srootOIDWaarp + &quot;.5.1&quot;);</span>
<span class="fc" id="L195">    rootOIDWaarpNotifStartOrShutdown = new OID(srootOIDWaarp + &quot;.5.1.1.1&quot;);</span>
<span class="fc" id="L196">  }</span>

  /**
   * Unregister and Register again the SNMPv2MIB with System adapted to this
   * Mib
   *
   * @throws DuplicateRegistrationException
   */
  protected void agentRegisterSystem() throws DuplicateRegistrationException {
    // Since BaseAgent registers some mibs by default we need to unregister
    // one before we register our own sysDescr. Normally you would
    // override that method and register the mibs that you need

<span class="fc" id="L209">    agent.unregisterManagedObject(agent.getSnmpv2MIB());</span>

    // Register a system description, use one from you product environment
    // to test with
<span class="fc" id="L213">    snmpv2 = new SNMPv2MIB(new OctetString(SnmpName), ggObjectId,</span>
                           new Integer32(SnmpService));
<span class="fc" id="L215">    snmpv2.setContact(new OctetString(SnmpDefaultAuthor));</span>
<span class="fc" id="L216">    snmpv2.setLocation(new OctetString(SnmpDefaultLocalization));</span>
<span class="fc" id="L217">    snmpv2.setName(new OctetString(SnmpVersion));</span>
<span class="fc" id="L218">    snmpv2.registerMOs(agent.getServer(), null);</span>
<span class="pc bpc" id="L219" title="1 of 2 branches missed.">    if (logger.isDebugEnabled()) {</span>
<span class="nc" id="L220">      logger.debug(</span>
<span class="nc" id="L221">          &quot;SNMPV2: &quot; + snmpv2.getContact() + ':' + snmpv2.getDescr() + ':' +</span>
<span class="nc" id="L222">          snmpv2.getLocation() + ':' + snmpv2.getName() + ':' +</span>
<span class="nc" id="L223">          snmpv2.getObjectID() + ':' + snmpv2.getServices() + ':' +</span>
<span class="nc" id="L224">          snmpv2.getUpTime());</span>
    }
    // Save UpTime reference since used everywhere
<span class="fc" id="L227">    upTime = snmpv2.getSysUpTime();</span>
<span class="fc" id="L228">  }</span>

  /**
   * Register this MIB
   *
   * @throws DuplicateRegistrationException
   */
  protected void agentRegisterWaarpMib() throws DuplicateRegistrationException {
<span class="fc" id="L236">    logger.debug(&quot;registerGGMib&quot;);</span>
    // register Static info
<span class="fc" id="L238">    rowInfo = new WaarpMORow(this, rootOIDWaarpInfo, WaarpDefinition,</span>
<span class="fc" id="L239">                             MibLevel.staticInfo.ordinal());</span>
<span class="fc" id="L240">    rowInfo.setValue(WaarpDefinitionIndex.applName.ordinal(),</span>
                     &quot;Waarp &quot; + &quot;GatewayFtp&quot;);
<span class="fc" id="L242">    rowInfo.setValue(WaarpDefinitionIndex.applServerName.ordinal(),</span>
<span class="fc" id="L243">                     FileBasedConfiguration.fileBasedConfiguration.getHostId());</span>
<span class="fc" id="L244">    rowInfo.setValue(WaarpDefinitionIndex.applVersion.ordinal(),</span>
<span class="fc" id="L245">                     Version.fullIdentifier());</span>
<span class="fc" id="L246">    rowInfo.setValue(WaarpDefinitionIndex.applDescription.ordinal(),</span>
                     &quot;Waarp Gateway Ftp: FTP Gateway&quot;);
<span class="fc" id="L248">    rowInfo.setValue(WaarpDefinitionIndex.applURL.ordinal(),</span>
                     &quot;http://waarp.github.com/Waarp&quot;);
<span class="fc" id="L250">    rowInfo.setValue(WaarpDefinitionIndex.applApplicationProtocol.ordinal(),</span>
                     applicationProtocol);

<span class="fc" id="L253">    rowInfo.registerMOs(agent.getServer(), null);</span>
    // register General info
<span class="fc" id="L255">    rowGlobal = new WaarpMORow(this, rootOIDWaarpGlobal, WaarpGlobalValues,</span>
<span class="fc" id="L256">                               MibLevel.globalInfo.ordinal());</span>
<span class="fc" id="L257">    WaarpMOScalar memoryScalar =</span>
<span class="fc" id="L258">        rowGlobal.getRow()[WaarpGlobalValuesIndex.memoryTotal.ordinal()];</span>
<span class="fc" id="L259">    memoryScalar.setValue(new MemoryGauge32(MemoryType.TotalMemory));</span>
<span class="fc" id="L260">    memoryScalar =</span>
<span class="fc" id="L261">        rowGlobal.getRow()[WaarpGlobalValuesIndex.memoryFree.ordinal()];</span>
<span class="fc" id="L262">    memoryScalar.setValue(new MemoryGauge32(MemoryType.FreeMemory));</span>
<span class="fc" id="L263">    memoryScalar =</span>
<span class="fc" id="L264">        rowGlobal.getRow()[WaarpGlobalValuesIndex.memoryUsed.ordinal()];</span>
<span class="fc" id="L265">    memoryScalar.setValue(new MemoryGauge32(MemoryType.UsedMemory));</span>
<span class="fc" id="L266">    rowGlobal.registerMOs(agent.getServer(), null);</span>
    // setup UpTime to SysUpTime and change status
<span class="fc" id="L268">    scalarUptime =</span>
<span class="fc" id="L269">        rowGlobal.getRow()[WaarpGlobalValuesIndex.applUptime.ordinal()];</span>
<span class="fc" id="L270">    scalarUptime.setValue(new WaarpUptime(upTime));</span>
<span class="fc" id="L271">    changeStatus(OperStatus.restarting);</span>
<span class="fc" id="L272">    changeStatus(OperStatus.up);</span>
    // register Detailed info
<span class="fc" id="L274">    rowDetailed =</span>
        new WaarpMORow(this, rootOIDWaarpDetailed, WaarpDetailedValues,
<span class="fc" id="L276">                       MibLevel.detailedInfo.ordinal());</span>
<span class="fc" id="L277">    rowDetailed.registerMOs(agent.getServer(), null);</span>
    // register Error info
<span class="fc" id="L279">    rowError = new WaarpMORow(this, rootOIDWaarpError, WaarpErrorValues,</span>
<span class="fc" id="L280">                              MibLevel.errorInfo.ordinal());</span>
<span class="fc" id="L281">    rowError.registerMOs(agent.getServer(), null);</span>
<span class="fc" id="L282">  }</span>

  /**
   * Unregister this MIB
   */
  protected void agentUnregisterMibs() {
<span class="nc" id="L288">    logger.debug(&quot;UnRegisterWaarp&quot;);</span>
<span class="nc" id="L289">    rowInfo.unregisterMOs(agent.getServer(), agent.getDefaultContext());</span>
<span class="nc" id="L290">    rowGlobal.unregisterMOs(agent.getServer(), agent.getDefaultContext());</span>
<span class="nc" id="L291">    rowDetailed.unregisterMOs(agent.getServer(), agent.getDefaultContext());</span>
<span class="nc" id="L292">    rowError.unregisterMOs(agent.getServer(), agent.getDefaultContext());</span>
<span class="nc" id="L293">  }</span>

  @Override
  public void registerMOs(MOServer moServer, OctetString octetString)
      throws DuplicateRegistrationException {
<span class="fc" id="L298">    agentRegisterSystem();</span>
<span class="fc" id="L299">    agentRegisterWaarpMib();</span>
<span class="fc" id="L300">  }</span>

  @Override
  public void unregisterMOs(MOServer moServer, OctetString octetString) {
<span class="nc" id="L304">    agentUnregisterMibs();</span>
<span class="nc" id="L305">  }</span>

  @Override
  public void setAgent(WaarpSnmpAgent agent) {
<span class="fc" id="L309">    this.agent = agent;</span>
<span class="fc" id="L310">  }</span>

  @Override
  public OID getBaseOidStartOrShutdown() {
<span class="nc" id="L314">    return rootOIDWaarpNotifStartOrShutdown;</span>
  }

  @Override
  public SNMPv2MIB getSNMPv2MIB() {
<span class="nc" id="L319">    return snmpv2;</span>
  }

  @Override
  public void updateServices(WaarpMOScalar scalar) {
    // Nothing
<span class="fc" id="L325">  }</span>

  @Override
  public void updateServices(MOScope range) {
    // Nothing
<span class="nc" id="L330">  }</span>

  /**
   * Change the status and the LastChange Timeticks
   *
   * @param status
   */
  public void changeStatus(OperStatus status) {
<span class="fc" id="L338">    final WaarpMOScalar statusScalar =</span>
<span class="fc" id="L339">        rowGlobal.getRow()[WaarpGlobalValuesIndex.applOperStatus.ordinal()];</span>
<span class="fc" id="L340">    final Integer32 var = (Integer32) statusScalar.getValue();</span>
<span class="pc bpc" id="L341" title="1 of 2 branches missed.">    if (var.getValue() != status.status) {</span>
<span class="fc" id="L342">      var.setValue(status.status);</span>
<span class="fc" id="L343">      final WaarpMOScalar lastTimeScalar =</span>
<span class="fc" id="L344">          rowGlobal.getRow()[WaarpGlobalValuesIndex.applLastChange.ordinal()];</span>
<span class="fc" id="L345">      final TimeTicks time = (TimeTicks) lastTimeScalar.getValue();</span>
<span class="fc" id="L346">      time.setValue(upTime.get().getValue());</span>
    }
<span class="fc" id="L348">  }</span>

  /**
   * Send a notification (trap or inform) for Shutdown event
   *
   * @param message
   * @param message2
   */
  public void notifyStartStop(String message, String message2) {
<span class="pc bpc" id="L357" title="1 of 2 branches missed.">    if (!TrapLevel.StartStop.isLevelValid(agent.getTrapLevel())) {</span>
<span class="fc" id="L358">      return;</span>
    }
<span class="nc" id="L360">    notify(NotificationElements.TrapShutdown, message, message2);</span>
<span class="nc" id="L361">  }</span>

  /**
   * Send a notification (trap or inform) for Error event
   *
   * @param message
   * @param message2
   */
  public void notifyError(String message, String message2) {
<span class="pc bpc" id="L370" title="1 of 2 branches missed.">    if (!TrapLevel.Alert.isLevelValid(agent.getTrapLevel())) {</span>
<span class="fc" id="L371">      return;</span>
    }
<span class="nc" id="L373">    notify(NotificationElements.TrapError, message, message2);</span>
<span class="nc" id="L374">  }</span>

  /**
   * Send a notification (trap or inform) for Server Overloaded event
   *
   * @param message
   * @param message2
   */
  public void notifyOverloaded(String message, String message2) {
<span class="pc bpc" id="L383" title="1 of 2 branches missed.">    if (!TrapLevel.Warning.isLevelValid(agent.getTrapLevel())) {</span>
<span class="fc" id="L384">      return;</span>
    }
<span class="nc" id="L386">    notify(NotificationElements.TrapOverloaded, message, message2);</span>
<span class="nc" id="L387">  }</span>

  /**
   * Send a notification (trap or inform) for Warning event
   *
   * @param message
   * @param message2
   */
  public void notifyWarning(String message, String message2) {
<span class="pc bpc" id="L396" title="1 of 2 branches missed.">    if (!TrapLevel.Warning.isLevelValid(agent.getTrapLevel())) {</span>
<span class="fc" id="L397">      return;</span>
    }
<span class="nc" id="L399">    notify(NotificationElements.TrapWarning, message, message2);</span>
<span class="nc" id="L400">  }</span>

  /**
   * Send a notification (trap or inform) for Warning/Error event on a single
   * Transfer Task
   *
   * @param message
   * @param runner
   */
  public void notifyInfoTask(String message, DbTransferLog runner) {
<span class="pc bpc" id="L410" title="1 of 2 branches missed.">    if (!TrapLevel.All.isLevelValid(agent.getTrapLevel())) {</span>
<span class="fc" id="L411">      return;</span>
    }
<span class="nc bnc" id="L413" title="All 2 branches missed.">    if (logger.isDebugEnabled()) {</span>
<span class="nc" id="L414">      logger.debug(</span>
          &quot;Notify: &quot; + NotificationElements.InfoTask + ':' + message + ':' +
          runner);
    }
<span class="nc" id="L418">    long delay =</span>
<span class="nc" id="L419">        (runner.getStart().getTime() - agent.getUptimeSystemTime()) / 10;</span>
<span class="nc bnc" id="L420" title="All 2 branches missed.">    if (delay &lt; 0) {</span>
<span class="nc" id="L421">      delay = 0;</span>
    }
<span class="nc" id="L423">    agent.getNotificationOriginator().notify(new OctetString(&quot;public&quot;),</span>
                                             NotificationElements.InfoTask
<span class="nc" id="L425">                                                 .getOID(rootOIDWaarpNotif),</span>
                                             new VariableBinding[] {
                                                 new VariableBinding(
                                                     NotificationElements.InfoTask
<span class="nc" id="L429">                                                         .getOID(</span>
                                                             rootOIDWaarpNotif,
                                                             1),
                                                     new OctetString(
                                                         NotificationElements.InfoTask
<span class="nc" id="L434">                                                             .name())),</span>
                                                 new VariableBinding(
                                                     NotificationElements.InfoTask
<span class="nc" id="L437">                                                         .getOID(</span>
                                                             rootOIDWaarpNotif,
                                                             1),
                                                     new OctetString(message)),
                                                 // Start of Task
                                                 new VariableBinding(
                                                     NotificationElements.InfoTask
<span class="nc" id="L444">                                                         .getOID(</span>
                                                             rootOIDWaarpNotif,
                                                             NotificationTasks.filenameInfo
<span class="nc" id="L447">                                                                 .getOID()),</span>
                                                     new OctetString(
<span class="nc" id="L449">                                                         runner.getFilename())),</span>
                                                 new VariableBinding(
                                                     NotificationElements.InfoTask
<span class="nc" id="L452">                                                         .getOID(</span>
                                                             rootOIDWaarpNotif,
                                                             NotificationTasks.modeTransInfo
<span class="nc" id="L455">                                                                 .getOID()),</span>
                                                     new OctetString(
<span class="nc" id="L457">                                                         runner.getMode())),</span>
                                                 new VariableBinding(
                                                     NotificationElements.InfoTask
<span class="nc" id="L460">                                                         .getOID(</span>
                                                             rootOIDWaarpNotif,
                                                             NotificationTasks.startTransInfo
<span class="nc" id="L463">                                                                 .getOID()),</span>
                                                     new TimeTicks(delay)),
                                                 new VariableBinding(
                                                     NotificationElements.InfoTask
<span class="nc" id="L467">                                                         .getOID(</span>
                                                             rootOIDWaarpNotif,
                                                             NotificationTasks.infoStatusInfo
<span class="nc" id="L470">                                                                 .getOID()),</span>
                                                     new OctetString(
<span class="nc" id="L472">                                                         runner.getErrorInfo()</span>
<span class="nc" id="L473">                                                               .getMesg())),</span>
                                                 new VariableBinding(
                                                     NotificationElements.InfoTask
<span class="nc" id="L476">                                                         .getOID(</span>
                                                             rootOIDWaarpNotif,
                                                             NotificationTasks.userIdInfo
<span class="nc" id="L479">                                                                 .getOID()),</span>
                                                     new OctetString(
<span class="nc" id="L481">                                                         runner.getUser())),</span>
                                                 new VariableBinding(
                                                     NotificationElements.InfoTask
<span class="nc" id="L484">                                                         .getOID(</span>
                                                             rootOIDWaarpNotif,
                                                             NotificationTasks.accountId
<span class="nc" id="L487">                                                                 .getOID()),</span>
                                                     new OctetString(
<span class="nc" id="L489">                                                         runner.getAccount())),</span>
                                                 new VariableBinding(
                                                     NotificationElements.InfoTask
<span class="nc" id="L492">                                                         .getOID(</span>
                                                             rootOIDWaarpNotif,
                                                             NotificationTasks.specialIdInfo
<span class="nc" id="L495">                                                                 .getOID()),</span>
                                                     new OctetString(String
<span class="nc" id="L497">                                                                         .valueOf(</span>
                                                                             runner
<span class="nc" id="L499">                                                                                 .getSpecialId()))),</span>
                                                 // End of Task
                                                 new VariableBinding(
                                                     SnmpConstants.sysDescr,
<span class="nc" id="L503">                                                     snmpv2.getDescr()),</span>
                                                 new VariableBinding(
                                                     SnmpConstants.sysObjectID,
<span class="nc" id="L506">                                                     snmpv2.getObjectID()),</span>
                                                 new VariableBinding(
                                                     SnmpConstants.sysContact,
<span class="nc" id="L509">                                                     snmpv2.getContact()),</span>
                                                 new VariableBinding(
                                                     SnmpConstants.sysName,
<span class="nc" id="L512">                                                     snmpv2.getName()),</span>
                                                 new VariableBinding(
                                                     SnmpConstants.sysLocation,
<span class="nc" id="L515">                                                     snmpv2.getLocation())</span>
                                             });
<span class="nc" id="L517">  }</span>

  /**
   * Trap/Notification
   *
   * @param element
   * @param message
   * @param message2
   */
  private void notify(NotificationElements element, String message,
                      String message2) {
<span class="nc bnc" id="L528" title="All 2 branches missed.">    if (logger.isDebugEnabled()) {</span>
<span class="nc" id="L529">      logger.debug(&quot;Notify: &quot; + element + ':' + message + ':' + message2);</span>
    }
<span class="nc" id="L531">    agent.getNotificationOriginator()</span>
<span class="nc" id="L532">         .notify(new OctetString(&quot;public&quot;), element.getOID(rootOIDWaarpNotif),</span>
                 new VariableBinding[] {
<span class="nc" id="L534">                     new VariableBinding(element.getOID(rootOIDWaarpNotif, 1),</span>
<span class="nc" id="L535">                                         new OctetString(element.name())),</span>
<span class="nc" id="L536">                     new VariableBinding(element.getOID(rootOIDWaarpNotif, 1),</span>
                                         new OctetString(message)),
<span class="nc" id="L538">                     new VariableBinding(element.getOID(rootOIDWaarpNotif, 1),</span>
                                         new OctetString(message2)),
                     new VariableBinding(SnmpConstants.sysDescr,
<span class="nc" id="L541">                                         snmpv2.getDescr()),</span>
                     new VariableBinding(SnmpConstants.sysObjectID,
<span class="nc" id="L543">                                         snmpv2.getObjectID()),</span>
                     new VariableBinding(SnmpConstants.sysContact,
<span class="nc" id="L545">                                         snmpv2.getContact()),</span>
                     new VariableBinding(SnmpConstants.sysName,
<span class="nc" id="L547">                                         snmpv2.getName()),</span>
                     new VariableBinding(SnmpConstants.sysLocation,
<span class="nc" id="L549">                                         snmpv2.getLocation())</span>
                 });
<span class="nc" id="L551">  }</span>

  /**
   * MIB entry levels
   */
<span class="fc" id="L556">  public enum MibLevel {</span>
<span class="fc" id="L557">    staticInfo, globalInfo, detailedInfo, errorInfo, trapInfo</span>
  }

  // From now the MIB definition

  /**
   * Notification Elements
   */
<span class="nc" id="L565">  public enum NotificationElements {</span>
<span class="nc" id="L566">    TrapShutdown(1), TrapError(2), TrapWarning(3), TrapOverloaded(4),</span>
<span class="nc" id="L567">    InfoTask(5);</span>

    public final int[] oid;

<span class="nc" id="L571">    NotificationElements(int oid) {</span>
<span class="nc" id="L572">      this.oid = new int[] { oid };</span>
<span class="nc" id="L573">    }</span>

    public OID getOID(OID oidBase) {
<span class="nc" id="L576">      return new OID(oidBase.getValue(), oid);</span>
    }

    public OID getOID(OID oidBase, int rank) {
<span class="nc" id="L580">      final int[] ids = { oid[0], rank };</span>
<span class="nc" id="L581">      return new OID(oidBase.getValue(), ids);</span>
    }
  }

  /**
   * Notification for a task trap
   */
<span class="nc" id="L588">  public enum NotificationTasks {</span>
<span class="nc" id="L589">    filenameInfo, modeTransInfo, startTransInfo, infoStatusInfo, userIdInfo,</span>
<span class="nc" id="L590">    accountId, specialIdInfo;</span>

    public int getOID() {
<span class="nc" id="L593">      return ordinal() + 1;</span>
    }
  }

  /**
   * Definition part
   */
<span class="fc" id="L600">  public enum WaarpDefinitionIndex {</span>
<span class="fc" id="L601">    applName, applServerName, applVersion, applDescription, applURL,</span>
<span class="fc" id="L602">    applApplicationProtocol;</span>

    public int getOID() {
<span class="nc" id="L605">      return ordinal() + 1;</span>
    }
  }

  /**
   * Definition part
   */
<span class="fc" id="L612">  public static final WaarpEntry[] WaarpDefinition =</span>
      WaarpPrivateMib.WaarpDefinition;

  /**
   * Global part
   */
<span class="fc" id="L618">  public enum WaarpGlobalValuesIndex {</span>
<span class="fc" id="L619">    applUptime, applOperStatus, applLastChange, applInboundAssociations,</span>
<span class="fc" id="L620">    applOutboundAssociations, applAccumInboundAssociations,</span>
<span class="fc" id="L621">    applAccumOutboundAssociations, applLastInboundActivity,</span>
<span class="fc" id="L622">    applLastOutboundActivity, applRejectedInboundAssociations,</span>
<span class="fc" id="L623">    applFailedOutboundAssociations, applInboundBandwidthKBS,</span>
<span class="fc" id="L624">    applOutboundBandwidthKBS, nbInfoUnknown, nbInfoNotUpdated,</span>
<span class="fc" id="L625">    nbInfoInterrupted, nbInfoToSubmit, nbInfoError, nbInfoRunning, nbInfoDone,</span>
<span class="fc" id="L626">    nbAllTransfer, memoryTotal, memoryFree, memoryUsed, nbThreads,</span>
<span class="fc" id="L627">    nbNetworkConnection;</span>

    public int getOID() {
<span class="fc" id="L630">      return ordinal() + 1;</span>
    }
  }

  /**
   * Global part
   */
<span class="fc" id="L637">  public static final WaarpEntry[] WaarpGlobalValues =</span>
      WaarpPrivateMib.WaarpGlobalValues;

  /**
   * Detailed part
   */
<span class="fc" id="L643">  public enum WaarpDetailedValuesIndex {</span>
<span class="fc" id="L644">    reply_000(ReplyCode.REPLY_000_SPECIAL_NOSTATUS),</span>
<span class="fc" id="L645">    reply_110(ReplyCode.REPLY_110_RESTART_MARKER_REPLY),</span>
<span class="fc" id="L646">    reply_120(ReplyCode.REPLY_120_SERVICE_READY_IN_NNN_MINUTES),</span>
<span class="fc" id="L647">    reply_125(ReplyCode.REPLY_125_DATA_CONNECTION_ALREADY_OPEN),</span>
<span class="fc" id="L648">    reply_150(ReplyCode.REPLY_150_FILE_STATUS_OKAY),</span>
<span class="fc" id="L649">    reply_200(ReplyCode.REPLY_200_COMMAND_OKAY),</span>
<span class="fc" id="L650">    reply_202(ReplyCode.REPLY_202_COMMAND_NOT_IMPLEMENTED),</span>
<span class="fc" id="L651">    reply_211(ReplyCode.REPLY_211_SYSTEM_STATUS_REPLY),</span>
<span class="fc" id="L652">    reply_212(ReplyCode.REPLY_212_DIRECTORY_STATUS),</span>
<span class="fc" id="L653">    reply_213(ReplyCode.REPLY_213_FILE_STATUS),</span>
<span class="fc" id="L654">    reply_214(ReplyCode.REPLY_214_HELP_MESSAGE),</span>
<span class="fc" id="L655">    reply_215(ReplyCode.REPLY_215_NAME_SYSTEM_TYPE),</span>
<span class="fc" id="L656">    reply_220(ReplyCode.REPLY_220_SERVICE_READY),</span>
<span class="fc" id="L657">    reply_221(ReplyCode.REPLY_221_CLOSING_CONTROL_CONNECTION),</span>
<span class="fc" id="L658">    reply_225(ReplyCode.REPLY_225_DATA_CONNECTION_OPEN_NO_TRANSFER_IN_PROGRESS),</span>
<span class="fc" id="L659">    reply_226(ReplyCode.REPLY_226_CLOSING_DATA_CONNECTION),</span>
<span class="fc" id="L660">    reply_227(ReplyCode.REPLY_227_ENTERING_PASSIVE_MODE),</span>
<span class="fc" id="L661">    reply_229(ReplyCode.REPLY_229_ENTERING_PASSIVE_MODE),</span>
<span class="fc" id="L662">    reply_230(ReplyCode.REPLY_230_USER_LOGGED_IN),</span>
<span class="fc" id="L663">    reply_232(ReplyCode.REPLY_232_USER_LOGGED_IN),</span>
<span class="fc" id="L664">    reply_234(ReplyCode.REPLY_234_SECURITY_DATA_EXCHANGE_COMPLETE),</span>
<span class="fc" id="L665">    reply_250(ReplyCode.REPLY_250_REQUESTED_FILE_ACTION_OKAY),</span>
<span class="fc" id="L666">    reply_257(ReplyCode.REPLY_257_PATHNAME_CREATED),</span>
<span class="fc" id="L667">    reply_331(ReplyCode.REPLY_331_USER_NAME_OKAY_NEED_PASSWORD),</span>
<span class="fc" id="L668">    reply_332(ReplyCode.REPLY_332_NEED_ACCOUNT_FOR_LOGIN), reply_350(</span>
        ReplyCode.REPLY_350_REQUESTED_FILE_ACTION_PENDING_FURTHER_INFORMATION);

    public final ReplyCode code;

<span class="fc" id="L673">    WaarpDetailedValuesIndex(ReplyCode code) {</span>
<span class="fc" id="L674">      this.code = code;</span>
<span class="fc" id="L675">    }</span>

    public int getOID() {
<span class="nc" id="L678">      return ordinal() + 1;</span>
    }
  }

  /**
   * Detailed part
   */
<span class="fc" id="L685">  public static final WaarpEntry[] WaarpDetailedValues = {</span>
      // reply_000,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_110,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_120,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_125,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_150,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_200,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_202,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_211,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_212,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_213,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_214,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_215,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_220,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_221,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_225,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_226,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_227,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_229,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_230,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_232,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_234,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_250,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_257,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_331,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_332,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_350
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32, MOAccessImpl.ACCESS_READ_ONLY)
  };

  /**
   * Error part
   */
<span class="fc" id="L768">  public enum WaarpErrorValuesIndex {</span>
<span class="fc" id="L769">    reply_421(</span>
        ReplyCode.REPLY_421_SERVICE_NOT_AVAILABLE_CLOSING_CONTROL_CONNECTION),
<span class="fc" id="L771">    reply_425(ReplyCode.REPLY_425_CANT_OPEN_DATA_CONNECTION),</span>
<span class="fc" id="L772">    reply_426(ReplyCode.REPLY_426_CONNECTION_CLOSED_TRANSFER_ABORTED),</span>
<span class="fc" id="L773">    reply_431(</span>
        ReplyCode.REPLY_431_NEED_UNAVAILABLE_RESOURCE_TO_PROCESS_SECURITY),
<span class="fc" id="L775">    reply_450(ReplyCode.REPLY_450_REQUESTED_FILE_ACTION_NOT_TAKEN),</span>
<span class="fc" id="L776">    reply_451(ReplyCode.REPLY_451_REQUESTED_ACTION_ABORTED),</span>
<span class="fc" id="L777">    reply_452(ReplyCode.REPLY_452_REQUESTED_ACTION_NOT_TAKEN),</span>
<span class="fc" id="L778">    reply_500(ReplyCode.REPLY_500_SYNTAX_ERROR_COMMAND_UNRECOGNIZED),</span>
<span class="fc" id="L779">    reply_501(ReplyCode.REPLY_501_SYNTAX_ERROR_IN_PARAMETERS_OR_ARGUMENTS),</span>
<span class="fc" id="L780">    reply_502(ReplyCode.REPLY_502_COMMAND_NOT_IMPLEMENTED),</span>
<span class="fc" id="L781">    reply_503(ReplyCode.REPLY_503_BAD_SEQUENCE_OF_COMMANDS),</span>
<span class="fc" id="L782">    reply_504(ReplyCode.REPLY_504_COMMAND_NOT_IMPLEMENTED_FOR_THAT_PARAMETER),</span>
<span class="fc" id="L783">    reply_522(</span>
        ReplyCode.REPLY_522_EXTENDED_PORT_FAILURE_UNKNOWN_NETWORK_PROTOCOL),
<span class="fc" id="L785">    reply_530(ReplyCode.REPLY_530_NOT_LOGGED_IN),</span>
<span class="fc" id="L786">    reply_532(ReplyCode.REPLY_532_NEED_ACCOUNT_FOR_STORING_FILES), reply_533(</span>
        ReplyCode.REPLY_533_COMMAND_PROTECTION_LEVEL_DENIED_FOR_POLICY_REASONS),
<span class="fc" id="L788">    reply_534(ReplyCode.REPLY_534_REQUEST_DENIED_FOR_POLICY_REASONS),</span>
<span class="fc" id="L789">    reply_535(ReplyCode.REPLY_535_FAILED_SECURITY_CHECK),</span>
<span class="fc" id="L790">    reply_536(ReplyCode.REPLY_536_REQUESTED_PROT_LEVEL_NOT_SUPPORTED),</span>
<span class="fc" id="L791">    reply_550(ReplyCode.REPLY_550_REQUESTED_ACTION_NOT_TAKEN),</span>
<span class="fc" id="L792">    reply_551(ReplyCode.REPLY_551_REQUESTED_ACTION_ABORTED_PAGE_TYPE_UNKNOWN),</span>
<span class="fc" id="L793">    reply_552(</span>
        ReplyCode.REPLY_552_REQUESTED_FILE_ACTION_ABORTED_EXCEEDED_STORAGE),
<span class="fc" id="L795">    reply_553(</span>
        ReplyCode.REPLY_553_REQUESTED_ACTION_NOT_TAKEN_FILE_NAME_NOT_ALLOWED);

    public final ReplyCode code;

<span class="fc" id="L800">    WaarpErrorValuesIndex(ReplyCode code) {</span>
<span class="fc" id="L801">      this.code = code;</span>
<span class="fc" id="L802">    }</span>

    public int getOID() {
<span class="nc" id="L805">      return ordinal() + 1;</span>
    }
  }

  /**
   * Error part
   */
<span class="fc" id="L812">  public static final WaarpEntry[] WaarpErrorValues = {</span>
      // reply_421,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_425,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_426,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_431,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_450,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_451,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_452,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_500,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_501,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_502,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_503,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_504,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_522,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_530,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_532,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_533,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_534,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_535,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_536,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_550,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_551,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_552,
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32,
                     MOAccessImpl.ACCESS_READ_ONLY),
      // reply_553
      new WaarpEntry(SMIConstants.SYNTAX_GAUGE32, MOAccessImpl.ACCESS_READ_ONLY)
  };

  /**
   * Oper Status (as defined in Net Application SNMP)
   */
<span class="fc" id="L886">  public enum OperStatus {</span>
<span class="fc" id="L887">    up(1), down(2), halted(3), congested(4), restarting(5), quiescing(6);</span>

    public final int status;

<span class="fc" id="L891">    OperStatus(int status) {</span>
<span class="fc" id="L892">      this.status = status;</span>
<span class="fc" id="L893">    }</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>